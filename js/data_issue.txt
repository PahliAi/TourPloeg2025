Data Flow Issues Analysis & Fix Plan                                                                                                       â”‚ â”‚
â”‚ â”‚                                                                                                                                            â”‚ â”‚
â”‚ â”‚ ğŸ” Root Cause Analysis                                                                                                                     â”‚ â”‚
â”‚ â”‚                                                                                                                                            â”‚ â”‚
â”‚ â”‚ The Main Problems:                                                                                                                         â”‚ â”‚
â”‚ â”‚                                                                                                                                            â”‚ â”‚
â”‚ â”‚ 1. Double Rider Creation System:                                                                                                           â”‚ â”‚
â”‚ â”‚   - window.allRidersFromExcel (from Excel Renners tab) vs allRiders (final processed array)                                                â”‚ â”‚
â”‚ â”‚   - Excel processing creates dynamic riders (like "Filippo Gana") when they're found in stage results but missing from Renners tab         â”‚ â”‚
â”‚ â”‚   - These dynamic riders get points but may be phantom entries                                                                             â”‚ â”‚
â”‚ â”‚ 2. Point Allocation Issues:                                                                                                                â”‚ â”‚
â”‚ â”‚   - Max stage points should be 53 (30+10+5+5+3), but system shows 55+ points                                                               â”‚ â”‚
â”‚ â”‚   - Missing jersey detection (Wit jersey missing in stage 1)                                                                               â”‚ â”‚
â”‚ â”‚   - Points getting duplicated or allocated incorrectly                                                                                     â”‚ â”‚
â”‚ â”‚ 3. Etapes Tab Using Wrong Data:                                                                                                            â”‚ â”‚
â”‚ â”‚   - My new Etapes functions use allRiders array (which includes phantom riders)                                                            â”‚ â”‚
â”‚ â”‚   - Should be using actual Excel stage results data directly                                                                               â”‚ â”‚
â”‚ â”‚   - Position calculation is based on points instead of actual Excel positions                                                              â”‚ â”‚
â”‚ â”‚                                                                                                                                            â”‚ â”‚
â”‚ â”‚ ğŸ¯ Specific Issues to Fix:                                                                                                                 â”‚ â”‚
â”‚ â”‚                                                                                                                                            â”‚ â”‚
â”‚ â”‚ 1. Jersey Detection Problem                                                                                                                â”‚ â”‚
â”‚ â”‚                                                                                                                                            â”‚ â”‚
â”‚ â”‚ In processRegularStageData() lines 697-754:                                                                                                â”‚ â”‚
â”‚ â”‚ - Jersey row detection is dynamic but unreliable                                                                                           â”‚ â”‚
â”‚ â”‚ - Should use fixed row positions: Geel=16, Groen=17, Wit=18, Bolletjes=19 (Excel rows 16-19)                                               â”‚ â”‚
â”‚ â”‚                                                                                                                                            â”‚ â”‚
â”‚ â”‚ 2. Point Over-allocation                                                                                                                   â”‚ â”‚
â”‚ â”‚                                                                                                                                            â”‚ â”‚
â”‚ â”‚ In processRegularStageData() lines 654-691:                                                                                                â”‚ â”‚
â”‚ â”‚ - Dynamic rider creation allows duplicate point allocation                                                                                 â”‚ â”‚
â”‚ â”‚ - No validation against actual Excel structure                                                                                             â”‚ â”‚
â”‚ â”‚ - Points get allocated to riders not in original Excel data                                                                                â”‚ â”‚
â”‚ â”‚                                                                                                                                            â”‚ â”‚
â”‚ â”‚ 3. Etapes Display Issues                                                                                                                   â”‚ â”‚
â”‚ â”‚                                                                                                                                            â”‚ â”‚
â”‚ â”‚ In my new functions (ui-components.js lines 1300-1400):                                                                                    â”‚ â”‚
â”‚ â”‚ - Using allRiders array instead of raw Excel data                                                                                          â”‚ â”‚
â”‚ â”‚ - Sorting by points instead of showing actual Excel positions                                                                              â”‚ â”‚
â”‚ â”‚ - No access to raw Excel stage results                                                                                                     â”‚ â”‚
â”‚ â”‚                                                                                                                                            â”‚ â”‚
â”‚ â”‚ ğŸ”§ Fix Strategy:                                                                                                                           â”‚ â”‚
â”‚ â”‚                                                                                                                                            â”‚ â”‚
â”‚ â”‚ Phase 1: Fix Excel Data Processing                                                                                                         â”‚ â”‚
â”‚ â”‚                                                                                                                                            â”‚ â”‚
â”‚ â”‚ 1. Fix jersey row detection - use hardcoded positions                                                                                      â”‚ â”‚
â”‚ â”‚ 2. Add validation to prevent over-allocation of points                                                                                     â”‚ â”‚
â”‚ â”‚ 3. Store raw Excel stage data for direct access by Etapes tab                                                                              â”‚ â”‚
â”‚ â”‚                                                                                                                                            â”‚ â”‚
â”‚ â”‚ Phase 2: Fix Etapes Tab                                                                                                                    â”‚ â”‚
â”‚ â”‚                                                                                                                                            â”‚ â”‚
â”‚ â”‚ 1. Create new data structure to store raw stage results from Excel                                                                         â”‚ â”‚
â”‚ â”‚ 2. Modify Etapes functions to use actual Excel positions (1-10 + jerseys)                                                                  â”‚ â”‚
â”‚ â”‚ 3. Fix riders table to show proper positions instead of point-sorted list                                                                  â”‚ â”‚
â”‚ â”‚ 4. Fix podium calculations to use stage-specific data, not cumulative arrays                                                               â”‚ â”‚
â”‚ â”‚                                                                                                                                            â”‚ â”‚
â”‚ â”‚ Phase 3: Data Validation                                                                                                                   â”‚ â”‚
â”‚ â”‚                                                                                                                                            â”‚ â”‚
â”‚ â”‚ 1. Add point allocation validation (max 53 per stage)                                                                                      â”‚ â”‚
â”‚ â”‚ 2. Add missing rider warnings without auto-creation                                                                                        â”‚ â”‚
â”‚ â”‚ 3. Add stage completeness checks                                                                                                           â”‚ â”‚
â”‚ â”‚                                                                                                                                            â”‚ â”‚
â”‚ â”‚ ğŸ“ Implementation Plan:                                                                                                                    â”‚ â”‚
â”‚ â”‚                                                                                                                                            â”‚ â”‚
â”‚ â”‚ 1. Add window.stageResultsRaw to store Excel stage data directly                                                                           â”‚ â”‚
â”‚ â”‚ 2. Fix jersey detection with hardcoded row numbers                                                                                         â”‚ â”‚
â”‚ â”‚ 3. Prevent phantom rider creation - only allocate points to Excel riders                                                                   â”‚ â”‚
â”‚ â”‚ 4. Rewrite Etapes display functions to use raw Excel data                                                                                  â”‚ â”‚
â”‚ â”‚ 5. Add validation logging for point allocation limits                                                                                      â”‚ â”‚
â”‚ â”‚                                                                                                                                            â”‚ â”‚
â”‚ â”‚ This will eliminate the 55+ point issue, show proper 1-10 + jersey positions, prevent phantom riders, and ensure Etapes tab displays       â”‚ â”‚
â”‚ â”‚ accurate Excel data.